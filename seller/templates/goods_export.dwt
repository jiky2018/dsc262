<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>{include file ='library/seller_html_head.lbi'}</head>

<body>
{include file ='library/seller_header.lbi'}
<div class="ecsc-layout">
    <div class="site wrapper">
        <div class="site wrapper">
            {include file ='library/seller_menu_left.lbi'}
            <div class="ecsc-layout-right">
                <div class="main-content" id="mainContent">
                    {include file ='library/url_here.lbi'}
                    {include file ='library/seller_menu_tab.lbi'}
                    <div class="wrapper-list">
                        <div class="explanation" id="explanation">
                            <div class="ex_tit"><i class="sc_icon"></i><h4>使用说明</h4></div>
                            {$lang.user_guide}
                        </div>
                        <div class="step" data-filter="goods" ectype="filter">
                            <div class="step_content">
                                <div class="goods_search_div mt20">
                                    <div class="search_select">
                                        <div class="categorySelect">
                                            <div class="selection">
                                                <input type="text" name="category_name" id="category_name" class="text w250 valid" value="请选择分类" autocomplete="off" readonly data-filter="cat_name" />
                                                <input type="hidden" name="category_id" id="category_id" value="0" data-filter="cat_id" />
                                            </div>
                                            <div class="select-container" style="display:none;">
                                                {include file="library/filter_category.lbi"}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="search_select">
                                        <div class="brandSelect">
                                            <div class="selection">
                                                <input type="text" name="brand_name" id="brand_name" class="text w120 valid" value="请选择品牌" autocomplete="off" readonly data-filter="brand_name" />
                                                <input type="hidden" name="brand_id" id="brand_id" value="0" data-filter="brand_id" />
                                            </div>
                                            <div class="brand-select-container" style="display:none;">
                                                {include file="library/filter_brand.lbi"}
                                            </div>
                                        </div>                            
                                    </div>
                                    <input type="text" name="keyword" class="text text_2 mr10" value="" placeholder="请输入关键字" data-filter="keyword" autocomplete="off" />
                                    <div style="border:1px dotted #f00; padding:0px 0px 0px 10px;" class="fl mr10 hide" ectype="limit_content">
                                        <input type="text" name="limit_start" class="text w50" value="0" placeholder="{$lang.limit_start}" data-filter="limit_start" autocomplete="off" />
                                        <input type="text" name="limit_number" class="text w50" value="50" placeholder="{$lang.limit_number}" data-filter="limit_number" autocomplete="off" />
                                    </div>
                                    <a href="javascript:void(0);" class="sc-btn sc-blueBg-btn" ectype="limit_button">范围</a>
                                    <a href="javascript:void(0);" class="sc-btn sc-blueBg-btn" ectype="search">搜索</a>
                                </div>
                                <div class="clear"></div>
                                <div class="tit">{$lang.export_condition}</div>
                                <div class="move_div mt10">
                                    <div class="move_left">
                                        <h4>可选商品</h4>
                                        <div class="move_info">
                                            <div class="move_list">
                                                {include file="library/move_left.lbi"}
                                            </div>
                                        </div>
                                        <div class="move_handle">
                                            <a href="javascript:void(0);" class="btn btn25 moveAll" ectype="moveAll">全选</a>
                                            <a href="javascript:void(0);" class="btn btn25 red_btn" ectype="sub" data-operation="add_export_goods">确定</a>
                                        </div>
                                    </div>
                                    <div class="move_middle">
                                        <div class="move_point" data-operation="add_export_goods"></div>
                                    </div>
                                    <div class="move_right">
                                        <h4>数据批量导出的商品</h4>
                                        <div class="move_info">
                                            <div class="move_list" id="export_goods">
                                                {include file="library/move_right.lbi"}
                                            </div>
                                        </div>
                                        <div class="move_handle">
                                            <a href="javascript:void(0);" class="btn btn25 moveAll" ectype="moveAll">全选</a>
                                            <a href="javascript:void(0);" class="btn btn25 btn_red" ectype="sub" data-operation="drop_export_goods">移除</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="move_buttom_div">
                                    <div class="data_format_select">
                                        <div class="label">{$lang.export_format}：</div>
                                        <div class="value">
                                            <div id="dataformat_select" class="imitate_select select_w320">
                                                <div class="cite">请选择</div>
                                                <ul style="display: none;">
                                                    {foreach from=$data_format item=data key=key}
                                                    <li><a href="javascript:;" data-value="{$key}" class="ftx-01">{$data}</a></li>
                                                    {/foreach}
                                                </ul>
                                                <input name="data_format" type="hidden" value="ecshop" id="dataformat_select_val">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="export_format"></div>
                    <div class="data_format_content" id="ecshop_form" style="display:none">
                        <form action="goods_export.php" method="post" name="theForm" >
                        <div class="item">
                            <div class="label">{$lang.select_charset}：</div>
                            <div class="value">
                                <div id="charset_select" class="imitate_select select_w320">
                                    <div class="cite">请选择</div>
                                    <ul style="display: none;">
                                        <li><a href="javascript:;" data-value="UTF8" class="ftx-01">UTF8</a></li>
                                        <li><a href="javascript:;" data-value="GB2312" class="ftx-01">GB2312</a></li>
                                        <li><a href="javascript:;" data-value="GBK" class="ftx-01">GBK</a></li>
                                    </ul>
                                    <input name="charset" type="hidden" value="UTF8" id="charset_select_val">
                                </div>
                            </div>
                        </div>
                        <div class="item mt30">
                            <div class="label">&nbsp;</div>
                            <div class="value">
                                <input name="cat_id" type="hidden" value="" />
                                <input name="brand_id" type="hidden" value="" />
                                <input name="keyword" type="hidden" value="" />
                                <input name="goods_ids" type="hidden" value="" />
                                <input type="hidden" name="act" value="act_export_ecshop">
                                <input name="submit" type="button" id="submit" value="{$lang.button_submit}" onclick="formValidate0()" class="sc-btn sc-blueBg-btn btn35" />
                            </div>
                        </div>
                        </form>
                    </div>
                    <div class="data_format_content" id="taobao_form" style="display:none">
                        <form action="goods_export.php" method="post" name="theForm1" onsubmit="return formValidate1()">
                        <div class="item">
                            <div class="label">{$lang.goods_class}：</div>
                            <div class="value"><input type="text" name="goods_class" class="text" value="0" autocomplete="off" /><div class="notic">宝贝栏目ID为淘宝分类的ID，如若不确定，请填写0</div></div>
                        </div>
                        <div class="item">
                            <div class="label">{$lang.post_express}：</div>
                            <div class="value"><input type="text" name="post_express" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item">
                            <div class="label">{$lang.express}：</div>
                            <div class="value"><input type="text" name="express" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item">
                            <div class="label">{$lang.ems}：</div>
                            <div class="value"><input type="text" name="ems" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item mt30">
                            <div class="label">&nbsp;</div>
                            <div class="value">
                                <input name="cat_id" type="hidden" value="" />
                                <input name="brand_id" type="hidden" value="" />
                                <input name="keyword" type="hidden" value="" />
                                <input name="goods_ids" type="hidden" value="" />
                                <input type="hidden" name="act" value="act_export_taobao">
                                <input name="submit" type="submit" id="submit" value="{$lang.button_submit}" class="sc-btn sc-blueBg-btn btn35" />
                            </div>
                        </div>
                        </form>
                    </div>
                    <div class="data_format_content" id="taobao V4.3_form" style="display:none">
                        <form action="goods_export.php" method="post" name="theForm3" onsubmit="return formValidate3()">
                        <div class="item">
                            <div class="label">{$lang.goods_class}：</div>
                            <div class="value"><input type="text" name="goods_class" class="text" value="0" autocomplete="off" /><div class="notic">宝贝栏目ID为淘宝分类的ID，如若不确定，请填写0</div></div>
                        </div>
                        <div class="item">
                            <div class="label">{$lang.post_express}：</div>
                            <div class="value"><input type="text" name="post_express" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item">
                            <div class="label">{$lang.express}：</div>
                            <div class="value"><input type="text" name="express" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item">
                            <div class="label">{$lang.ems}：</div>
                            <div class="value"><input type="text" name="ems" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item mt30">
                            <div class="label">&nbsp;</div>
                            <div class="value">
                                <input name="cat_id" type="hidden" value="" />
                                <input name="brand_id" type="hidden" value="" />
                                <input name="keyword" type="hidden" value="" />
                                <input name="goods_ids" type="hidden" value="" />
                                <input type="hidden" name="act" value="act_export_taobao V4.3">
                                <input name="submit" type="submit" id="submit" value="{$lang.button_submit}" class="sc-btn sc-blueBg-btn btn35" />
                            </div>
                        </div>
                        </form>
                    </div>
                    <div class="data_format_content" id="taobao V4.6_form" style="display:none">
                        <form action="goods_export.php" method="post" name="theForm6" onsubmit="return formValidate6()">
                        <div class="item">
                            <div class="label">{$lang.goods_class}：</div>
                            <div class="value"><input type="text" name="goods_class" class="text" value="0" autocomplete="off" /><div class="notic">宝贝栏目ID为淘宝分类的ID，如若不确定，请填写0</div></div>
                        </div>
                        <div class="item">
                            <div class="label">{$lang.post_express}：</div>
                            <div class="value"><input type="text" name="post_express" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item">
                            <div class="label">{$lang.express}：</div>
                            <div class="value"><input type="text" name="express" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item">
                            <div class="label">{$lang.ems}：</div>
                            <div class="value"><input type="text" name="ems" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item mt30">
                            <div class="label">&nbsp;</div>
                            <div class="value">
                                <input name="cat_id" type="hidden" value="" />
                                <input name="brand_id" type="hidden" value="" />
                                <input name="keyword" type="hidden" value="" />
                                <input name="goods_ids" type="hidden" value="" />
                                <input type="hidden" name="act" value="act_export_taobao V4.6">
                                <input name="submit" type="submit" id="submit" value="{$lang.button_submit}" class="sc-btn sc-blueBg-btn btn35" />
                            </div>
                        </div>
                        </form>
                    </div>
                    <div class="data_format_content" id="paipai_form" style="display:none">
                        <form action="goods_export.php" method="post"  name="theForm2" onsubmit="return formValidate2()">
                        <div class="item">
                            <div class="label">{$lang.post_express}：</div>
                            <div class="value"><input type="text" name="post_express" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item">
                            <div class="label">{$lang.express}：</div>
                            <div class="value"><input type="text" name="express" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item mt30">
                            <div class="label">&nbsp;</div>
                            <div class="value">
                                <input name="cat_id" type="hidden" value="" />
                                <input name="brand_id" type="hidden" value="" />
                                <input name="keyword" type="hidden" value="" />
                                <input name="goods_ids" type="hidden" value="" />
                                <input type="hidden" name="act" value="act_export_paipai">
                                <input name="submit" type="submit" id="submit" value="{$lang.button_submit}" class="sc-btn sc-blueBg-btn btn35" />
                            </div>
                        </div>
                        </form>
                    </div>
                    <div class="data_format_content" id="paipai4_form" style="display:none">
                        <form action="goods_export.php" method="post"  name="theForm5" onsubmit="return formValidate5()">
                        <div class="item">
                            <div class="label">{$lang.post_express}：</div>
                            <div class="value"><input type="text" name="post_express" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item">
                            <div class="label">{$lang.express}：</div>
                            <div class="value"><input type="text" name="express" class="text" value="0" autocomplete="off" /></div>
                        </div>
                        <div class="item mt30">
                            <div class="label">&nbsp;</div>
                            <div class="value">
                                <input name="cat_id" type="hidden" value="" />
                                <input name="brand_id" type="hidden" value="" />
                                <input name="keyword" type="hidden" value="" />
                                <input name="goods_ids" type="hidden" value="" />
                                <input type="hidden" name="act" value="act_export_paipai4">
                                <input name="submit" type="submit" id="submit" value="{$lang.button_submit}" class="sc-btn sc-blueBg-btn btn35" />
                            </div>
                        </div>
                        </form>
                    </div>
                    <div class="data_format_content" id="custom_form" style="display:none">
                        <form action="goods_export.php" method="post"  name="theForm4" onsubmit="return formValidate4()">
                        <div class="item">
                            <div class="label">{$lang.select_charset}：</div>
                            <div class="value">
                                <div id="custom_charset_select" class="imitate_select select_w320">
                                    <div class="cite">请选择</div>
                                    <ul style="display: none;">
                                        <li><a href="javascript:;" data-value="UTF8" class="ftx-01">UTF8</a></li>
                                        <li><a href="javascript:;" data-value="GB2312" class="ftx-01">GB2312</a></li>
                                        <li><a href="javascript:;" data-value="GBK" class="ftx-01">GBK</a></li>
                                    </ul>
                                    <input name="charset" type="hidden" value="UTF8" id="custom_charset_select_val">
                                </div>
                            </div>
                        </div>									
                        
                        <div class="step" ectype="filter" data-filter="goods_type">
                            <div class="step_content">									
                                <div class="goods_search_div">
                                    <div class="imitate_select select_w170">
                                        <div class="cite">选择类型</div>
                                        <ul style="display: none;">
                                            <li><a href="javascript:;" data-value="0" class="ftx-01">所有类型</a></li>
                                            {foreach from=$goods_type_list item=goods_type}
                                            <li><a href="javascript:;" data-value="{$goods_type.cat_id}" class="ftx-01">{$goods_type.cat_name}</a></li>
                                            {/foreach}
                                        </ul>
                                        <input name="goods_type" type="hidden" value="0" id="" data-filter="keyword" />
                                    </div>
                                    <a href="javascript:void(0);" class="sc-btn sc-blueBg-btn" ectype="search">搜索</a>
                                </div>									
                                <div class="move_div">
                                    <div class="move_left">
                                        <h4>可选数据列</h4>
                                        <div class="move_info">
                                            <div class="move_list">
                                                <ul>
                                                    {foreach from=$goods_fields item=item key=key}
                                                    <li data-value="{$key}" data-text="{$item}"><i class="sc_icon sc_icon_ok"></i><a href="javascript:void(0);">{$item}</a></li>
                                                    {/foreach}
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="move_handle">
                                            <a href="javascript:void(0);" class="sc-btn btn25 moveAll" ectype="moveAll">全选</a>
                                            <a href="javascript:void(0);" class="sc-btn btn25 sc-blueBg-btn" ectype="sub" data-operation="add_goods_fields">确定</a>
                                        </div>
                                    </div>
                                    <div class="move_middle">
                                        <div class="move_point" data-operation="add_goods_fields"></div>
                                    </div>
                                    <div class="move_right">
                                        <h4>输出数据列</h4>
                                        <div class="move_info">
                                            <div class="move_list" id="goods_type">
                                                {include file="library/move_right.lbi"}
                                            </div>
                                        </div>
                                        <div class="move_handle">
                                            <a href="javascript:void(0);" class="sc-btn btn25 moveAll" ectype="moveAll">全选</a>
                                            <a href="javascript:void(0);" class="sc-btn btn25 sc-blueBg-btn" ectype="sub" data-operation="drop_goods_fields">移除</a>
                                        </div>
                                    </div>
                                </div>	
                            </div>
                        </div>
                        <div class="button-bottom">				
                            <div class="button_info">
                                <input name="cat_id" type="hidden" value="" />
                                <input name="brand_id" type="hidden" value="" />
                                <input name="keyword" type="hidden" value="" />
                                <input name="goods_ids" type="hidden" value="" />
                                <input type="hidden" name="act" value="act_export_custom">
                                <input type="hidden" name="custom_goods_export" value="">
                                <input name="submit" type="submit" id="submit" value="{$lang.button_submit}" class="sc-btn sc-blueBg-btn btn35" />
                            </div>
                        </div>
                        </form>
                    </div>
                    <div class="clear"></div>
                    <div class="list-div mt20" id="listDiv">
                      <table class="ecsc-default-table" id='listTable'>
                      	<thead>
                        <tr>
                          <th>页数</th>
                          <th>总数</th>
                          <th>时间</th>
                        </tr>
                        </thead>
                      </table>
                    </div>
                    <div style="display:none;border: 1px solid rgb(204, 0, 0);margin-top:10px; padding: 4px; background-color: rgb(255, 255, 206); color: rgb(206, 0, 0);" id="errorMsg" ></div>
                </div>
            </div>
        </div>
    </div>
</div>
{include file='library/seller_footer.lbi'}
<script type="text/javascript">
	var post_express_not_null = "{$lang.post_express_not_null}";
	var express_not_null = "{$lang.express_not_null}";
	var ems_not_null = "{$lang.ems_not_null}";
	var custom_goods_field_not_null = "{$lang.custom_goods_field_not_null}";
	//切换显示 by wu
	$("#dataformat_select li").click(function(){
		var data_format = $(this).find("a").data("value");
		show_data_format(data_format)
	});
    //切换显示 by wu

    var elements;
    var restart = 1, start = 1;
    function formValidate0()
    {
        var src_obj = document.forms['searchForm'];
        var dst_obj = document.forms['theForm'];
        copy_search_result(src_obj, dst_obj);
        
        if(arguments.length == 0)
        {
            var filter='', page=1, page_size=50, total=1, mark=0;
            var filter_obj = new Object;
			//修改 by wu start
			filter_obj.cat_id = $(".step[ectype=filter] input[data-filter=cat_id]").val();
			filter_obj.brand_id = $(".step[ectype=filter] input[data-filter=brand_id]").val();
			filter_obj.keyword = $(".step[ectype=filter] input[data-filter=keyword]").val();
			var goods_lists = new Array();
			$(".step[ectype=filter] .move_right .move_list ul li.current").each(function(){
				goods_lists.push($(this).data("value"));
			});
			filter_obj.goods_ids = goods_lists.join(',');
			//修改 by wu end
            var filter = JSON.stringify(filter_obj);
        }else
        {
            var filter, page, page_size, total, mark;
            filter = JSON.stringify(arguments[0]);
            page = arguments[1];
            page_size = arguments[2];
            total = arguments[3];
            mark = arguments[4];
        }
        if(arguments.length > 0)
        {
            start = 0;
        }
        Ajax.call('goods_export.php?act=act_export_step_search', 'start='+ start +'&is_ajax=1&filter=' + filter + '&page=' + page + '&page_size=' + page_size + '&total=' + total+ '&mark=' + mark , start_response, 'GET', 'JSON');
        //return true;
    }
    /**
    * 处理反馈信息
    * @param: result
    * @return
    */
   function start_response(result)
   {
       if(result.mark == 0 && result.page <= result.total_page)
       {
           var filter = JSON.stringify(result.filter);
           setTimeout('formValidate0('+filter+', '+ result.page +', '+ result.page_size +', '+ result.total +', '+ result.mark +')', 10000);
           location.href = 'goods_export.php?act=act_export_ecshop&filter=' + filter + '&page=' + result.page + '&page_size=' + result.page_size + '&total=' + result.total+ '&mark=' + result.mark;
       }else
       {
           alert('已下载完成！');
       }
       
       //没有执行错误
       if (result.error == 0)
       {
         if (result.done == 0)
         {
           restart = 1;
           /* 结束时，删除多余的最后一行 */
           var tbl = document.getElementById("listTable"); //获取表格对象
           tbl.deleteRow(tbl.rows.length - 1);
         }
         else
         {
           var cell;
           var tbl = document.getElementById("listTable"); //获取表格对象

           if (result.done == 1)
           {
               if (tbl.rows.length >1)
               /* 已经换模块，删除多余的最后一行 */
               {
                   tbl.deleteRow(tbl.rows.length - 1);
               }
             /* 产生一个标题行 */
             var row = tbl.insertRow(-1);

             cell = row.insertCell(0);
             cell.className = 'first-cell';
             cell.colSpan = '3';
             cell.innerHTML = result.title ;
           }

           //创建新任务行
           var row = tbl.insertRow(-1);
           if(result.page <= result.total_page)
           {
                cell = row.insertCell(0);
                cell.innerHTML = result.row.new_page ;
                cell = row.insertCell(1);
                cell.innerHTML = result.row.new_total ;
                cell = row.insertCell(2);
                cell.id = result.row.cur_id;
                cell.innerHTML = result.row.new_time ;
            }
            if(result.row.pre_id)
            {
                document.getElementById(result.row.pre_id).innerHTML = result.row.pre_time; //更新上一行执行时间
            }
         }

         if (result.content.length > 0)
         {
           var elem = document.getElementById('errorMsg');
           elem.style.display = '';
           elem.innerHTML += result.content;
         }
       }

       if (result.message.length > 0)
       {
         //有信息则输出出错信息
         alert(result.message);
       }
   }
    /**
     * 检查输入是否完整
     */
    function formValidate2()
    {
        var elements = document.forms['theForm2'].elements;
        var msg = '';

        if (parseFloat(elements['post_express'].value) <= 0)
        {
            msg += post_express_not_null + '\n';
        }
        if (parseFloat(elements['express'].value) <= 0)
        {
            msg += express_not_null + '\n';
        }
        if (msg.length > 0)
        {
            alert(msg);
            return false;
        }
        else
        {
            var src_obj = document.forms['searchForm'];
            var dst_obj = document.forms['theForm2'];
            copy_search_result(src_obj, dst_obj);
            return true;
        }
    }

    /**
     * 检查输入是否完整
     */
    function formValidate1()
    {
        var elements = document.forms['theForm1'].elements;
        var msg = '';

        if (parseFloat(elements['post_express'].value) <= 0)
        {
            msg += post_express_not_null + '\n';
        }
        if (parseFloat(elements['express'].value) <= 0)
        {
            msg += express_not_null + '\n';
        }
        if (parseFloat(elements['ems'].value) <= 0)
        {
            msg += ems_not_null + '\n';
        }
        if (msg.length > 0)
        {
            alert(msg);
            return false;
        }
        else
        {
            var src_obj = document.forms['searchForm'];
            var dst_obj = document.forms['theForm1'];
            copy_search_result(src_obj, dst_obj);
            return true;
        }
    }
    /**
     * 检查输入是否完整
     */
    function formValidate3()
    {
        var elements = document.forms['theForm3'].elements;
        var msg = '';

        if (parseFloat(elements['post_express'].value) <= 0)
        {
            msg += post_express_not_null + '\n';
        }
        if (parseFloat(elements['express'].value) <= 0)
        {
            msg += express_not_null + '\n';
        }
        if (parseFloat(elements['ems'].value) <= 0)
        {
            msg += ems_not_null + '\n';
        }
        if (msg.length > 0)
        {
            alert(msg);
            return false;
        }
        else
        {
            var src_obj = document.forms['searchForm'];
            var dst_obj = document.forms['theForm3'];
            copy_search_result(src_obj, dst_obj);
            return true;
        }
    }
   /**
     * 检查输入是否完整
     */
    function formValidate6()
    {
        var elements = document.forms['theForm6'].elements;
        var msg = '';

        if (parseFloat(elements['post_express'].value) <= 0)
        {
            msg += post_express_not_null + '\n';
        }
        if (parseFloat(elements['express'].value) <= 0)
        {
            msg += express_not_null + '\n';
        }
        if (parseFloat(elements['ems'].value) <= 0)
        {
            msg += ems_not_null + '\n';
        }
        if (msg.length > 0)
        {
            alert(msg);
            return false;
        }
        else
        {
            var src_obj = document.forms['searchForm'];
            var dst_obj = document.forms['theForm6'];
            copy_search_result(src_obj, dst_obj);
            return true;
        }
    }
	/* 检查输入是否完整 */
    function formValidate4 ()
    {
        var elements = document.forms['theForm4'].elements;
        var msg = '';
        if ($(".step[ectype=filter] .move_right .move_list ul li.current").length <= 0)
        {
            msg += custom_goods_field_not_null + '\n';
        }
        if (msg.length > 0)
        {
            alert(msg);
            return false;
        }
        else
        {
            elements['custom_goods_export'].value = '';
			var idArr = new Array();
			$("#goods_type ul li.current").each(function(){
				idArr.push($(this).data("value"));
			});
			elements['custom_goods_export'].value = idArr.join(',');
			
            var src_obj = document.forms['searchForm'];
            var dst_obj = document.forms['theForm4'];
            copy_search_result(src_obj, dst_obj);
            return true;
        }
    }

    /**
     * 检查输入是否完整
     */
    function formValidate5()
    {
        var elements = document.forms['theForm5'].elements;
        var msg = '';

        if (parseFloat(elements['post_express'].value) <= 0)
        {
            msg += post_express_not_null + '\n';
        }
        if (parseFloat(elements['express'].value) <= 0)
        {
            msg += express_not_null + '\n';
        }
        if (msg.length > 0)
        {
            alert(msg);
            return false;
        }
        else
        {
            var src_obj = document.forms['searchForm'];
            var dst_obj = document.forms['theForm5'];
            copy_search_result(src_obj, dst_obj);
            return true;
        }
    }
    function copy_search_result(src_obj, dst_obj)
    {
       dst_obj.cat_id.value = $(".step[ectype=filter] input[data-filter=cat_id]").val();
        dst_obj.brand_id.value = $(".step[ectype=filter] input[data-filter=brand_id]").val();
        dst_obj.keyword.value = $(".step[ectype=filter] input[data-filter=keyword]").val();
        var goods_lists = new Array();
		$("#export_goods ul li.current").each(function(){
			goods_lists.push($(this).data("value"));
		});
		dst_obj.goods_ids.value = goods_lists.join(',');
    }

    /**
     * 绑定商品类型控件事件
     */
    $.divselect("#goods_type_select","#goods_type_select_val",function(obj){
        var val = obj.attr("data-value");
        Ajax.call('goods_export.php?is_ajax=1&act=get_goods_fields&cat_id='+val, '' , goodsFieldsResponse , 'POST', 'JSON');
    });
    function goodsFieldsResponse (result)
    {
        if (result.error > 0)
        {
            alert(result.message);
            return;
        }
        Utils.$('src_goods_fields').innerHTML = '';
        for (var key in result.content)
        {
            if (typeof (result.content[key]) == 'string')
            {
                var new_opt = document.createElement('OPTION');
                new_opt.value = key;
                new_opt.innerHTML = result.content[key];
                Utils.$('src_goods_fields').appendChild(new_opt);
            }
        }
    }
     /* 搜索商品列表 */
    function queryGoods(obj)
    {
        var filters = new Object;
        filters.cat_id = obj.cat_id.value;
        filters.brand_id = obj.brand_id.value;
        filters.keyword = obj.keyword.value;
        Ajax.call('goods_export.php?is_ajax=1&act=get_goods_list', filters, queryGoodsResponse , 'POST', 'JSON');
        return false;
    }

    function queryGoodsResponse (result)
    {
        if (result.error > 0)
        {
            alert(result.message);
            return;
        }
        Utils.$('src_goods_lists').innerHTML = '';
        for (var i=0,l=result.content.length;i<l;++i)
        {
            var new_opt = document.createElement('OPTION');
            new_opt.value = result.content[i].goods_id;
            new_opt.innerHTML = result.content[i].goods_name;
            Utils.$('src_goods_lists').appendChild(new_opt);
        }
    }

    /**
     * 上一次操作的对象
     */
    window.last_form = new Object;
    /**
     * 初始化导出格式
     */
    function init_data_format ()
    {
        //var _format = Utils.$('data_format');
        var _format = Utils.$('dataformat_select_val'); //by wu
        show_data_format(_format.value);
        _format.onchange = function ()
        {
            show_data_format(this.value);
        }
    }

    /**
     * 显示要导出的格式页面
     *
     * @param page string 页面
     *
     * @return void
     */
    function show_data_format (page)
    {
        try
        {
            window.last_form.style.display = 'none';
        }
        catch (e)
        {
        }
        var _page = Utils.$(page+'_form');
        _page.style.display = '';
        Utils.$('export_format').appendChild(_page);
        window.last_form = _page;
    }

    if (Browser.isIE)
    {
        window.attachEvent("onload", init_data_format);
    }
    else
    {
        window.addEventListener("load", init_data_format, false);
    }

    //导出设置
    $(function(){
        $(document).on('click', "[ectype='limit_button']", function(){
            if($("[ectype='limit_content']").hasClass('hide')){
                $("[ectype='limit_content']").removeClass('hide');
            }else{
                $("[ectype='limit_content']").addClass('hide');
            }
        })
    })
</script>
</body>
</html>